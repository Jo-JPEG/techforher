{% extends "base.html" %}

{% block content %}
<div class="windows95-container w-[80%] mx-auto mt-10 p-4 border-2 border-gray-400 bg-gray-300 shadow-md rounded-md">
    <div class="windows95-form-title">
    <h2 class="windows95-form-title-text">Mentorship Connections</h2>
    </div>
    <!-- Success Message -->
    {% if message_sent %}
        <div class="alert alert-success mb-4 p-4 border-2 border-solid border-gray-600 bg-gray-200 text-green-900 shadow-sm">
            Your message has been sent successfully!
        </div>
    {% endif %}

    <!-- Mentor Search Functionality -->
    <h3>Search for a Mentor</h3>
    <form method="POST">
        {% csrf_token %}
        {{ search_form.as_p }}
        <button type="submit" name="search_mentor" class="btn btn-primary">Search</button>
    </form>

    <!-- Display Search Results -->
    {% if search_results %}
        <h4>Search Results:</h4>
        <ul>
            {% for mentor in search_results %}
                <li>
                    {{ mentor.username }} - {{ mentor.role }}
                    <!-- Contact Mentor Button -->
                    <form method="POST" style="display: inline;">
                        {% csrf_token %}
                        <input type="hidden" name="mentor_id" value="{{ mentor.id }}">
                        {{ contact_form.as_p }}
                        <button type="submit" name="contact_mentor" class="btn btn-secondary">Contact</button>
                    </form>
                </li>
            {% empty %}
                <li>No mentors found for the selected language.</li>
            {% endfor %}
        </ul>
    {% endif %}

    <!-- Match Mentor to Mentee (Admin Only) -->
    {% if request.user.is_staff %}
        <h3>Match Mentor to Mentee</h3>
        <form method="POST">
            {% csrf_token %}
            {{ match_form.as_p }}
            <button type="submit" name="match_mentor" class="btn btn-success">Match</button>
        </form>
    {% endif %}

    <!-- Display Existing Mentorships -->
    <h4>Existing Mentorships:</h4>
    <ul>
        {% for mentorship in mentorships %}
            <li>{{ mentorship.mentor }} matched with {{ mentorship.mentee }} ({{ mentorship.preferred_language }})</li>
        {% empty %}
            <li>No mentorships found.</li>
        {% endfor %}
    </ul>
</div>
{% endblock %}